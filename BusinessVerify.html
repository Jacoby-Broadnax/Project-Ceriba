<html>
  <head>
    <meta name="language" content="English" />
    <title>Project Ceriba</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="style_business_verification.css"
      type="text/css"
    />
    <link rel="stylesheet" href="style_header_nav" type="text/css" />
    <link rel="icon" href="favicon.ico" />
    <script src="/delete_handler.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    
    <script type="text/javascript">

      function callit() {
        var link = "https://v2-api.sheety.co/1c0174d5b32dbebdf6f1e14d6ba67a4f/projectCeriba/ceriba";
          var idNum = document.getElementById("idsT").value;
          var actionlink = link + "/" + String(idNum);
             $.getJSON(actionlink, function (data) {
              var template = Handlebars.compile($('#item-template').html())
              $('#result').html(template(data.ceriba))
          })
      }
  </script>
  
  <script id="item-template" type="text/x-handlebars-template">
   <ul>
    <span>{{timestamp}}</span>
  <span>ID{{id}}</span>

   </ul>
  </script>

  </head>

  <body>
    <div class="verification_wrap" id="verify">
      <h4>Verification</h4>
      <p>
        In order to post what items a business has in stock, we must verify you
        are a owner of a bussiness. Enter a associated business e-mail below.
      </p>
      <form action="BusinessForm.html">
        <input
          id="email_verify"
          type="email"
          placeholder="example@business.com"
          pattern="^[A-Za-z0-9_.]+[@](?!.*(gmail.com|yahoo.com|outlook.com|hotmail.com|[;\-&_'+,<>])).*(\.)[A-Za-z0-9_.]+$"
          required
        />
        <input id="verify_submit" type="submit" value="Submit" />
      </form>
    </div>

    <div class="verification_wrap" id="sorryID">
      <h4>Sorry! No can do</h4>
      <p>
        We detected that you already have a post made, if you would like to update your business stock, delete your previous post or wait until the next day.
      </p>

      <form  id="delete" onsubmit="bsCode()">
        <input id="ids" type="text" name="id" pattern="^[0-9]*$"  required/>
        <input id="verify_submit" type="submit" value="Submit" />
      </form>
      
      <form  id="test" onsubmit="callit()">
        <input id="idsT" type="text" name="id" pattern="^[0-9]*$"  required/>
        <input id="verify_submit" type="submit" value="Submit" />
      </form>
    </div>

    <div id="result"></div>

    <script>
      window.onload = function(){
        var time = new Date();
          var n = time.getDay();
          if (window.localStorage["day"] == null){
              window.localStorage.setItem("day", n)
          }
          if (window.localStorage["day"] != n){
              window.localStorage.removeItem("ID")
              window.localStorage.setItem("day", n)
          }
      }

        if (window.localStorage["ID"] == null || window.localStorage["ID"] == ""){
          document.getElementById("verify").style.display = "flex"
          document.getElementById("sorryID").style.display = "none"
          document.getElementById("test").style.display = "none"
        }
        else{
          document.getElementById("verify").style.display = "none"
          document.getElementById("sorryID").style.display = "flex"
          document.getElementById("test").style.display = "flex"
        }

        function bsCode(){
          var link = "https://v2-api.sheety.co/1c0174d5b32dbebdf6f1e14d6ba67a4f/projectCeriba/ceriba";
          var idNum = document.getElementById("ids").value;
          var actionlink = link + "/" + String(idNum);
          document.getElementById("delete").setAttribute("action", actionlink)
          window.location.replace("../BusinessVerify.html")
          
        }

    </script>


  </body>
</html>
